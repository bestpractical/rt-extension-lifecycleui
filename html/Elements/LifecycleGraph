<div class="lifecycle-ui" id="lifecycle-<% $id %>">
    <svg<% $Editing ? ' class="editing"' : '' |n %>>
        <& /Elements/LifecycleGraphExtras, %ARGS &>
        <g class="transitions"></g>
        <g class="statuses"></g>
        <g class="decorations"></g>
    </svg>
% if ($Editing) {
    <& /Elements/LifecycleInspector &>
% }
    <script type="text/javascript">
        jQuery(function () {
            jQuery(".lifecycle-ui#lifecycle-<% $id %>").each(function () {
                var container = this;
                var config = <% JSON($config) |n %>;
% if ($Ticket) {
                var ticketStatus = <% $Ticket->Status | j%>;
% } else {
                var ticketStatus = undefined;
% }

% if ($Editing) {
                var editor = new RT.LifecycleEditor();
                editor.initializeEditor(container, config, ticketStatus);
% } else {
                var viewer = new RT.LifecycleViewer();
                viewer.initializeViewer(container, config, ticketStatus);
% }
            });
        });
    </script>
</div>
<%ARGS>
$Editing => 0
$Lifecycle => undef
$Ticket => undef
</%ARGS>
<%INIT>
$Lifecycle ||= $Ticket->Lifecycle
    if $Ticket;

my $config = RT->Config->Get('Lifecycles')->{$Lifecycle};
Abort("Invalid Lifecycle") if !$Lifecycle || !$config;

my $id = $Lifecycle . '-' . int(rand(2**31));
</%INIT>
